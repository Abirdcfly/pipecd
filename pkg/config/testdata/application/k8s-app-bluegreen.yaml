# Pipeline for a Kubernetes application.
# This makes a progressive delivery with BlueGreen strategy.
apiVersion: pipecd.dev/v1beta1
kind: KubernetesApp
spec:
  pipeline:
    stages:
      - name: K8S_STAGE_OUT
      - name: K8S_TRAFFIC_ROUTE
        with:
          target: stage
      - name: K8S_PRIMARY_OUT
      - name: K8S_TRAFFIC_ROUTE
        with:
          target: primary
      - name: K8S_STAGE_IN

---
# Pipeline for a Kubernetes application.
# This makes a progressive delivery with BlueGreen strategy.
# This also requires an approval before switch traffic to the stage.
apiVersion: pipecd.dev/v1beta1
kind: KubernetesApp
spec:
  pipeline:
    stages:
      - name: K8S_STAGE_OUT
      - name: WAIT_APPROVAL
        with:
          approvers:
            - user-foo
            - user-bar
      - name: K8S_TRAFFIC_ROUTE
        with:
          target: stage
      - name: K8S_PRIMARY_OUT
      - name: K8S_TRAFFIC_ROUTE
        with:
          target: primary
      - name: K8S_STAGE_IN

---
# Pipeline for a Kubernetes application.
# This makes a progressive delivery with BlueGreen strategy.
# This also has a ANALYSIS stage for running smoke test againts the stage.
apiVersion: pipecd.dev/v1beta1
kind: KubernetesApp
spec:
  pipeline:
    stages:
      - name: K8S_STAGE_OUT
      - name: ANALYSIS
        with:
          duration: 10m
          threshold: 2
          https:
            - useTemplate: http_stage_check
      - name: K8S_TRAFFIC_ROUTE
        with:
          target: stage
      - name: K8S_PRIMARY_OUT
      - name: K8S_TRAFFIC_ROUTE
        with:
          target: primary
      - name: K8S_STAGE_IN
