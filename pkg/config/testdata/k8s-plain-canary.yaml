kind: K8sApp
spec:
  pipeline:
    stages:
      - name: K8S_CANARY_OUT
        with:
          weight: 10
      - name: VERIFICATION
        desc: Verify canary by metrics and smoke test
        with:
          duration: 10m
          metrics:
            - query: grpc_error_percentage
              expected: < 0.1
              interval: 1m
          https:
            - url: https://your-endpoint
              epxected: 200
              interval: 1m
      - name: APPROVAL
      - name: K8S_APPLY
      - name: K8S_CANARY_IN
