version: v1
kind: Build
spec:
  postsubmits:
  - name: push-images
    timeout: 30m
    machine:
      resource: medium
    dockerAuth:
      secret:
        name: container_registry_service_account
        type: PROJECT
    branches:
      - master
    steps:
    - description: Push service images
      runner: gcr.io/kapetanios/kapetanios-runner:0.2.0
      commands:
        - make push-images
      envs:
        - IS_CI=true
      secrets:
      - name: bazel_cache_service_account
        type: PROJECT
